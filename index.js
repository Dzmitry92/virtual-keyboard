const keyboard = [
    [   
        {
            '192':   {
                en: ['`','~'],
                ru: ['ё','Ё'],
            }
        },

        {
            '49':   {
                en: ['1','!'],
                ru: ['1','!'],
            }
        },

        {
            '50':   {
                en: ['2','@'],
                ru: ['2', '"'],
            }
        },

        {
            '51':   {
                en: ['3','#'],
                ru: ['3','№'],
            }
        },

        {
            '52':   {
                en: ['4','$'],
                ru: ['4',';'],
            }
        },

        {
            '53':   {
                en: ['5','%'],
                ru: ['5','%'],
            }
        },

        {
            '54':   {
                en: ['6','^'],
                ru: ['6',':'],
            }
        },

        {
            '55':   {
                en: ['7','&'],
                ru: ['7','?'],
            }
        },

        {
            '56':   {
                en: ['8','*'],
                ru: ['8','*'],
            }
        },

        {
            '57':   {
                en: ['9','('],
                ru: ['9','('],
            }
        },

        {
            '48':   {
                en: ['0',')'],
                ru: ['0',')'],
            }
        },

        {
            '189':   {
                en: ['-','_'],
                ru: ['-','_'],
            }
        },

        {
            '187':   {
                en: ['=','+'],
                ru: ['=','+'],
            }
        },

        {
            '8':   {
                en: ['Backspace','Backspace'],
                ru: ['Backspace','Backspace'],
            }
        },        
    ],

    [
        {
            '9':   {
                en: ['Tab', 'Tab'],
                ru: ['Tab', 'Tab'],
            }
        },

        {
            '81':   {
                en: ['q','Q'],
                ru: ['й','Й'],
            }
        },

        {
            '87':   {
                en: ['w','W'],
                ru: ['ц','Ц'],
            }
        },

        {
            '69':   {
                en: ['e','E'],
                ru: ['у','У'],
            }
        },

        {
            '82':   {
                en: ['r','R'],
                ru: ['к','К'],
            }
        },

        {
            '84':   {
                en: ['t','T'],
                ru: ['е','Е'],
            }
        },

        {
            '89':   {
                en: ['y','Y'],
                ru: ['н','Н'],
            }
        },

        {
            '85':   {
                en: ['u','U'],
                ru: ['г','Г'],
            }
        },

        {
            '73':   {
                en: ['i','I'],
                ru: ['ш','Ш'],
            }
        },

        {
            '79':   {
                en: ['o','O'],
                ru: ['щ','Щ'],
            }
        },

        {
            '80':   {
                en: ['p','P'],
                ru: ['з','З'],
            }
        },

        {
            '219':   {
                en: ['[','{'],
                ru: ['х','Х'],
            }
        },

        {
            '221':   {
                en: [']','}'],
                ru: ['ъ','Ъ'],
            }
        },
        {
            '220':   {
                en: ['\\','|'],
                ru: ['\\','/'],
            }
        },

        {
            '46':   {
                en: ['Del','Del'],
                ru: ['Del','Del'],
            }
        },
    ],

    [
        {
            '20':   {
                en: ['CapsLock','CapsLock'],
                ru: ['CapsLock','CapsLock'],
                }
        },
        {
            '65':   {
                en: ['a','A'],
                ru: ['ф','Ф'],
            }
        },
        {
            '83':   {
                en: ['s','S'],
                ru: ['ы','Ы'],
            }
        },
        {
            '68':   {
                en: ['d','D'],
                ru: ['в','В'],
            }
        },
        {
            '70':   {
                en: ['f','F'],
                ru: ['а','А'],
            }
        },
        {
            '71':   {
                en: ['g','G'],
                ru: ['п','П'],
            }
        },
        {
            '72':   {
                en: ['h','H'],
                ru: ['р','Р'],
            }
        },
        {
            '74':   {
                en: ['j','J'],
                ru: ['о','О'],
            }
        },
        {
            '75':   {
                en: ['k','K'],
                ru: ['л','Л'],
            }
        },
        {
            '76':   {
                en: ['l','L'],
                ru: ['д','Д'],
            }
        },
        {
            '186':   {
                en: [';',':'],
                ru: ['ж','Ж'],
            }
        },
        {
            '222':   {
                en: ["'",'"'],
                ru: ['э','Э'],
            }
        },
        {
            '13':   {
                en: ['Enter','Enter'],
                ru: ['Enter','Enter'],
            }
        },
    ],

    [
        {
            '16':   {
                en: ['Shift','Shift'],
                ru: ['Shift','Shift'],
            }
        },

        {
            '226':   {
                en: ['\\','|'],
                ru: ['\\','/'],
            }
        },

        {
            '90':   {
                en: ['z','Z'],
                ru: ['я','Я'],
            }
        },

        {
            '88':   {
                en: ['x','X'],
                ru: ['ч','Ч'],
            }
        },

        {
            '67':   {
                en: ['c','C'],
                ru: ['с','С'],
            }
        },

        {
            '86':   {
                en: ['v','V'],
                ru: ['м','М'],
            }
        },

        {
            '66':   {
                en: ['b','B'],
                ru: ['и','И'],
            }
        },

        {
            '78':   {
                en: ['n','N'],
                ru: ['т','Т'],
            }
        },

        {
            '77':   {
                en: ['m','M'],
                ru: ['ь','Ь'],
            }
        },

        {
            '188':   {
                en: [',','<'],
                ru: ['б','Б'],
            }
        },

        {
            '190':   {
                en: ['.','>'],
                ru: ['ю','Ю'],
            }
        },

        {
            '191':   {
                en: ['/','?'],
                ru: ['.',','],
            }
        },

        {
            '38':   {
                en: ['Up','Up'],
                ru: ['Up','Up'],
            }
        },

        {
            '16':   {
                en: ['Shift','Shift'],
                ru: ['Shift','Shift'],
            }
        },
    ],

    [
        {
            '17':   {
                en: ['Ctrl','Ctrl'],
                ru: ['Ctrl','Ctrl'],
            }
        },
        {
            '91':   {
                en: ['Win','Win'],
                ru: ['Win','Win'],
                
            }
        },
        {
            '18':   {
                en: ['Alt','Alt'],
                ru: ['Alt','Alt'],
            }
        },
        {
            '32':   {
                en: [' ',' '],
                ru: [' ',' '],
            }
        },
        {
            '18':   {
                en: ['Alt','Alt'],
                ru: ['Alt','Alt'],
            }
        },
        {
            '17':   {
                en: ['Ctrl','Ctrl'],
                ru: ['Ctrl','Ctrl'],
            }
        },
        {
            '37':   {
                en: ['Left','Left'],
                ru: ['Left','Left'],
            }
        },
        {
            '40':   {
                en: ['Down','Down'],
                ru: ['Down','Down'],
            }
        },
        {
            '39':   {
                en: ['Right','Right'],
                ru: ['Right','Right'],
            }
        },
    ],
]

// create DOM
let currentLang = localStorage.getItem('lang') || 'en';
let cups = false;
const input = document.createElement('textarea');
const root = document.createElement('div'); 
root.id = 'root';
input.id = 'keyboard-input';
document.body.append(input);
document.body.append(root);
input.disabled = true;

keyboard.forEach(function(row) {
    const rowWraper = document.createElement('div');
    row.forEach(function(buttonObj) {
        const key = Object.keys(buttonObj)[0];
        const button = document.createElement('button');
        button.id = key;
        button.setAttribute('uniqueAttribute', buttonObj[key][currentLang][0]);
        button.classList.add('button');
        button.innerHTML = buttonObj[key][currentLang][0];
        rowWraper.appendChild(button);
    });
    root.appendChild(rowWraper);
});

function switchLang() {
    currentLang === 'en' ? currentLang = 'ru' : currentLang = 'en';
    localStorage.setItem('lang', currentLang);
}

function updateKeys() {
    keyboard.forEach(function(row) {
        row.forEach(function(buttonObj) {
            const key = Object.keys(buttonObj)[0];
            const button = document.getElementById(key);
            button.setAttribute('uniqueAttribute', buttonObj[key][currentLang][0]);
            button.innerHTML = buttonObj[key][currentLang][0];
        })
    })
}

function shiftUpdateKeys() {
    keyboard.forEach(function(row) {
        row.forEach(function(buttonObj) {
            const key = Object.keys(buttonObj)[0];
            const button = document.getElementById(key);
            button.setAttribute('uniqueAttribute', buttonObj[key][currentLang][1]);
            button.innerHTML = buttonObj[key][currentLang][1];
        })
    })
}

function capsUpdateKeys(){
    cups === false ? (shiftUpdateKeys(), cups = true) : (updateKeys(), cups = false);
}

document.addEventListener('click', function(e) {

    if (e.target.tagName === 'BUTTON'){

        // if Backspace / Delete mouse
        if (e.target.id === '8' || e.target.id === '46') {
            input.value = input.value.slice(0, input.value.length - 1);
            return;
        }

        //if Tab mouse
        if(e.target.id === '9'){
            const value = '\t';
            input.value += value;
            return;
        }

        // if Enter mouse
        if (e.target.id === '13'){
            const value = '\n';
            input.value += value;
            return;
        }

        // if Shift / Ctrl / Alt / Win mouse
        if (e.target.id === '16' || e.target.id === '91' || e.target.id === '18' || e.target.id === '17'){
            const value = '';
            input.value += value;
            return;
        }

        //if CupsLock mouse
        if(e.target.id === '20'){
            const activeCaps = document.getElementById('20');
            cups === false ? (shiftUpdateKeys(), activeCaps.classList.add('etherColor'), cups = true) : (updateKeys(), activeCaps.classList.remove('etherColor'), cups = false);
            const value = '';
            input.value += value;
            return;
        }

        const value = e.target.getAttribute('uniqueAttribute');
        input.value += value;
    }
});

document.addEventListener('mousedown', function(e){
    if(e.target.tagName === 'BUTTON'){
        const clickButton = document.getElementById(e.target.id);
        if(e.target.id === '16') {
            shiftUpdateKeys();
        }

        clickButton.classList.add('pressed');
    }
});

document.addEventListener('mouseup', function(e){
    const endPressed = document.querySelector('.pressed');
    if(endPressed === null){
        return;
    }
    if(e.target.id === '16') {
        updateKeys();
    }
    endPressed.classList.remove('pressed');
});

document.addEventListener('keydown', function(e) {
    e.preventDefault();
    const pressedButton = document.getElementById(e.keyCode);

    if (pressedButton !== null) {

        pressedButton.classList.add('pressed');

        // if Backspace / Delete keyboard
        if (e.keyCode === 8 || e.keyCode === 46) {
            input.value = input.value.slice(0, input.value.length - 1);
            return;
        }

        //if Tab keyboard
        if  (e.keyCode === 9){
            const value = '\t';
            input.value += value;
            return;
        }
        
        // if Enter keyboard
        if (e.keyCode === 13) {
            const value = '\n';
            input.value += value;
            return;
        }

        // if  Ctrl / Alt keyboard
        if (e.keyCode === 18 || e.keyCode === 17 || e.keyCode === 91) {
            const value = '';
            input.value += value;
            return;
        }

        //if Shift keyboard
        if (e.keyCode === 16) {
            cups === false ? shiftUpdateKeys() : updateKeys();
            const value = '';
            input.value += value;
            return;
        }

        //if CupsLock keyboard
        if(e.keyCode === 20) {
           const activeCaps = document.getElementById('20');
           cups === false ? activeCaps.classList.add('etherColor') : activeCaps.classList.remove('etherColor');
           const value = '';
           input.value += value;
           return;
        }

        const value = pressedButton.getAttribute('uniqueAttribute');
        input.value += value;
    }
});

document.addEventListener('keyup', function(e) {
    const pressedButton = document.getElementById(e.keyCode);
    if (pressedButton !== null) {
        pressedButton.classList.remove('pressed');

         // if switchLang
         if (e.keyCode === 18 || e.keyCode === 17) {
          
            const ctrl = document.getElementById('17');
            const alt = document.getElementById('18');

            if (e.keyCode === 18 && ctrl.className === 'button pressed' || e.keyCode === 17 && alt.className === 'button pressed') {
                switchLang();
                updateKeys();
            }
            return;
        }

        if (e.keyCode === 16) {
            cups === false ? updateKeys() : shiftUpdateKeys();
            return;
        }

        if (e.keyCode === 20) {
            capsUpdateKeys();
            return;
        }
    }
});