const keyboard = [
    [   
        {
            '192':   {
                en: '`',
                ru: 'ё',
            }
        },

        {
            '49':   {
                en: '1',
                ru: '1',
            }
        },

        {
            '50':   {
                en: '2',
                ru: '2',
            }
        },

        {
            '51':   {
                en: '3',
                ru: '3',
            }
        },

        {
            '52':   {
                en: '4',
                ru: '4',
            }
        },

        {
            '53':   {
                en: '5',
                ru: '5',
            }
        },

        {
            '54':   {
                en: '6',
                ru: '6',
            }
        },

        {
            '55':   {
                en: '7',
                ru: '7',
            }
        },

        {
            '56':   {
                en: '8',
                ru: '8',
            }
        },

        {
            '57':   {
                en: '9',
                ru: '9',
            }
        },

        {
            '48':   {
                en: '0',
                ru: '0',
            }
        },

        {
            '189':   {
                en: '-',
                ru: '-',
            }
        },

        {
            '187':   {
                en: '=',
                ru: '=',
            }
        },

        {
            '8':   {
                en: 'Backspace',
                ru: 'Backspace',
            }
        },        
    ],

    [
        {
            '9':   {
                en: 'Tab',
                ru: 'Tab',
            }
        },

        {
            '81':   {
                en: 'q',
                ru: 'й',
            }
        },

        {
            '87':   {
                en: 'w',
                ru: 'ц',
            }
        },

        {
            '69':   {
                en: 'e',
                ru: 'у',
            }
        },

        {
            '82':   {
                en: 'r',
                ru: 'к',
            }
        },

        {
            '84':   {
                en: 't',
                ru: 'е',
            }
        },

        {
            '89':   {
                en: 'y',
                ru: 'н',
            }
        },

        {
            '85':   {
                en: 'u',
                ru: 'г',
            }
        },

        {
            '73':   {
                en: 'i',
                ru: 'ш',
            }
        },

        {
            '79':   {
                en: 'o',
                ru: 'щ',
            }
        },

        {
            '80':   {
                en: 'p',
                ru: 'з',
            }
        },

        {
            '219':   {
                en: '[',
                ru: 'х',
            }
        },

        {
            '221':   {
                en: ']',
                ru: 'ъ',
            }
        },
        {
            '220':   {
                en: '\\',
                ru: '\\',
            }
        },

        {
            '46':   {
                en: 'Del',
                ru: 'Del',
            }
        },
    ],

    [
        {
            '20':   {
                en: 'CapsLock',
                ru: 'CapsLock',
                }
        },
        {
            '65':   {
                en: 'a',
                ru: 'ф',
            }
        },
        {
            '83':   {
                en: 's',
                ru: 'ы',
            }
        },
        {
            '68':   {
                en: 'd',
                ru: 'в',
            }
        },
        {
            '70':   {
                en: 'f',
                ru: 'а',
            }
        },
        {
            '71':   {
                en: 'g',
                ru: 'п',
            }
        },
        {
            '72':   {
                en: 'h',
                ru: 'р',
            }
        },
        {
            '74':   {
                en: 'j',
                ru: 'о',
            }
        },
        {
            '75':   {
                en: 'k',
                ru: 'л',
            }
        },
        {
            '76':   {
                en: 'l',
                ru: 'д',
            }
        },
        {
            '186':   {
                en: ';',
                ru: 'ж',
            }
        },
        {
            '222':   {
                en: "'",
                ru: 'э',
            }
        },
        {
            '13':   {
                en: 'Enter',
                ru: 'Enter',
            }
        },
    ],

    [
        {
            '16':   {
                en: 'Shift',
                ru: 'Shift',
            }
        },

        {
            '226':   {
                en: '\\',
                ru: '\\',
            }
        },

        {
            '90':   {
                en: 'z',
                ru: 'я',
            }
        },

        {
            '88':   {
                en: 'x',
                ru: 'ч',
            }
        },

        {
            '67':   {
                en: 'c',
                ru: 'с',
            }
        },

        {
            '86':   {
                en: 'v',
                ru: 'м',
            }
        },

        {
            '66':   {
                en: 'b',
                ru: 'и',
            }
        },

        {
            '78':   {
                en: 'n',
                ru: 'т',
            }
        },

        {
            '77':   {
                en: 'm',
                ru: 'ь',
            }
        },

        {
            '188':   {
                en: ',',
                ru: 'б',
            }
        },

        {
            '190':   {
                en: '.',
                ru: 'ю',
            }
        },

        {
            '191':   {
                en: '/',
                ru: '.',
            }
        },

        {
            '38':   {
                en: 'up',
                ru: 'up',
            }
        },

        {
            '16':   {
                en: 'Shift',
                ru: 'Shift',
            }
        },
    ],

    [
        {
            '17':   {
                en: 'Ctrl',
                ru: 'Ctrl'
            }
        },
        {
            '91':   {
                en: 'win',
                ru: 'win'
                
            }
        },
        {
            '18':   {
                en: 'Alt',
                ru: 'Alt'
            }
        },
        {
            '32':   {
                en: ' ',
                ru: ' '
            }
        },
        {
            '18':   {
                en: 'Alt',
                ru: 'Alt'
            }
        },
        {
            '17':   {
                en: 'Ctrl',
                ru: 'Ctrl'
            }
        },
        {
            '37':   {
                en: 'left',
                ru: 'left'
            }
        },
        {
            '40':   {
                en: 'down',
                ru: 'down'
            }
        },
        {
            '39':   {
                en: 'right',
                ru: 'right'
            }
        },
    ],
]

let currentLang = localStorage.getItem('lang') || 'en';
const input = document.createElement('textarea');
const root = document.createElement('div'); 
root.id = 'root';
input.id = 'keyboard-input';
document.body.append(input);
document.body.append(root);
input.disabled = true;

keyboard.forEach(function(row) {
    const rowWraper = document.createElement('div');
    row.forEach(function(buttonObj) {
        const key = Object.keys(buttonObj)[0];
        const button = document.createElement('button');
        button.id = key;
        button.setAttribute('uniqueAttribute', buttonObj[key][currentLang]);
        button.classList.add('button');
        button.innerHTML = buttonObj[key][currentLang];
        rowWraper.appendChild(button);
    });
    root.appendChild(rowWraper);
});

function switchLang() {
    currentLang === 'en' ? currentLang = 'ru' : currentLang = 'en';
    localStorage.setItem('lang', currentLang);
}

function updateKeys() {
    keyboard.forEach(function(row) {
        row.forEach(function(buttonObj) {
            const key = Object.keys(buttonObj)[0];
            const button = document.getElementById(key);
            button.setAttribute('uniqueAttribute', buttonObj[key][currentLang]);
            button.innerHTML = buttonObj[key][currentLang];
        })
    })
}

document.addEventListener('click', function(e) {

    if (e.target.tagName === 'BUTTON'){

        if (e.target.id === '8') {
            input.value = input.value.slice(0, input.value.length - 1);
        }

        if (e.target.id === '13'){
            const value = '\n';
            input.value += value;
        }

        const value = e.target.getAttribute('uniqueAttribute');
        input.value += value;
    }
});

document.addEventListener('mousedown', function(e){
    if(e.target.tagName === 'BUTTON'){
        const clickButton = document.getElementById(e.target.id);
        if(clickButton !== null){
            clickButton.classList.add('pressed');
        }
    }
});

document.addEventListener('mouseup', function(){
    const endPressed = document.querySelector('.pressed');
    if(endPressed === null){
        return;
    }
    endPressed.classList.remove('pressed');
});

document.addEventListener('keydown', function(e) {
    e.preventDefault();
    const pressedButton = document.getElementById(e.keyCode);

    if (pressedButton !== null) {

        pressedButton.classList.add('pressed');

        // if Backspace
        if (e.keyCode === 8) {
            input.value = input.value.slice(0, input.value.length - 1);
            return;
        }
        
        // if Enter
        if (e.keyCode === 13) {
            const value = '\n';
            input.value += value;
            return;
        }

         // if switchLang
        if (e.keyCode === 16 || e.keyCode === 18) {
          
            const ctrl = document.getElementById('18');
            const shift = document.getElementById('16');

            if (e.keyCode === 16 && ctrl.className === 'button pressed' || e.keyCode === 18 && shift.className === 'button pressed') {
                switchLang();
                updateKeys();
            }

            return;
        }

        const value = pressedButton.getAttribute('uniqueAttribute');
        input.value += value;
    }
});

document.addEventListener('keyup', function(e) {
    const pressedButton = document.getElementById(e.keyCode);
    if (pressedButton !== null) {
        pressedButton.classList.remove('pressed');
    }
});